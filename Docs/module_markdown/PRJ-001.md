## PRJ-001: 채용 프로젝트 생성 및 관리

본 기능은 인증된 사용자가 자신의 채용 공고 프로젝트를 생성, 조회, 수정, 삭제하는 **CRUD(Create, Read, Update, Delete)** 작업을 담당합니다. 생성된 프로젝트는 `INP-*` 기능들을 통해 상세 내용이 채워지는 기반 데이터가 됩니다.

### 1\. 사용자 시나리오 (User Scenario)

* **프로젝트 생성:** 김 대리는 로그인 후 대시보드에서 '새 프로젝트 시작하기' 버튼을 클릭합니다. '백엔드 개발자 채용'이라는 이름으로 새 프로젝트를 생성하고, 채용 정보 입력 페이지(`/new`)로 이동합니다.
* **프로젝트 목록 조회:** 며칠 후 김 대리가 다시 로그인하여 대시보드(`/dashboard`)에 접속하자, 이전에 생성했던 '백엔드 개발자 채용' 프로젝트와 'UI/UX 디자이너 채용' 프로젝트 목록이 최신순으로 정렬되어 표시됩니다.
* **프로젝트 수정:** 김 대리는 '백엔드 개발자 채용' 프로젝트의 제목을 '시니어 백엔드 개발자 채용'으로 수정합니다.
* **프로젝트 삭제:** 채용이 완료된 'UI/UX 디자이너 채용' 프로젝트를 목록에서 선택하여 삭제합니다.

### 2\. API 명세 (API Specification)

**공통 사항:** 모든 API는 `Authorization: Bearer <accessToken>` 헤더가 필요하며, 인증 실패 시 `401 Unauthorized`를 반환합니다.

#### 2.1. 새 채용 프로젝트 생성 (Create)

* **Endpoint:** `POST /postings`
* **Description:** 사용자의 새 채용 프로젝트를 초기 상태로 생성합니다.
* **Request:**
    * **Body:**
      ```json
      {
        "title": "시니어 백엔드 개발자 채용"
      }
      ```
* **Response:**
    * **Success (201 Created):** 생성된 프로젝트의 ID와 기본 정보를 반환합니다.
      ```json
      {
        "id": "clx123abcde",
        "title": "시니어 백엔드 개발자 채용",
        "status": "DRAFT", // "DRAFT", "PUBLISHED" 등 초기 상태
        "createdAt": "2025-10-17T02:30:00.000Z",
        "updatedAt": "2025-10-17T02:30:00.000Z",
        "userId": "user-cuid-12345"
      }
      ```
    * **Error (400 Bad Request):** `title`이 누락된 경우.
      ```json
      {
        "statusCode": 400,
        "message": [
          "title should not be empty"
        ],
        "error": "Bad Request"
      }
      ```

#### 2.2. 내 채용 프로젝트 목록 조회 (Read - List)

* **Endpoint:** `GET /postings`
* **Description:** 현재 로그인한 사용자가 생성한 모든 채용 프로젝트 목록을 조회합니다. (대시보드용)
* **Request:** (Query Parameters로 페이징 및 정렬 추가 가능)
    * `GET /postings?page=1&limit=10&sortBy=createdAt&order=desc`
* **Response:**
    * **Success (200 OK):**
      ```json
      {
        "data": [
          {
            "id": "clx123abcde",
            "title": "시니어 백엔드 개발자 채용",
            "status": "DRAFT",
            "updatedAt": "2025-10-17T02:30:00.000Z"
          },
          {
            "id": "clx009zyxwv",
            "title": "UI/UX 디자이너 채용",
            "status": "PUBLISHED",
            "updatedAt": "2025-10-15T09:15:00.000Z"
          }
        ],
        "meta": {
          "totalItems": 2,
          "currentPage": 1,
          "totalPages": 1
        }
      }
      ```

#### 2.3. 특정 채용 프로젝트 상세 조회 (Read - Detail)

* **Endpoint:** `GET /postings/:id`
* **Description:** 특정 ID의 채용 프로젝트 상세 정보를 조회합니다. (수정 페이지 진입 시 데이터 로딩용)
* **Request:**
    * **Path Variable:** `id` (프로젝트의 CUID)
* **Response:**
    * **Success (200 OK):** 프로젝트의 모든 저장된 정보를 반환합니다. (향후 `INP-*` 명세에서 추가될 필드 포함)
      ```json
      {
        "id": "clx123abcde",
        "title": "시니어 백엔드 개발자 채용",
        "status": "DRAFT",
        // ... (INP-001 핵심 정보)
        "companyName": "AI 솔루션즈",
        "jobTitle": "Backend Developer",
        // ... (INP-003 기업 정보)
        "companyIntro": "저희는...",
        "logoImageUrl": "https://s3...",
        "createdAt": "2025-10-17T02:30:00.000Z",
        "updatedAt": "2025-10-17T02:30:00.000Z",
        "userId": "user-cuid-12345"
      }
      ```
    * **Error (404 Not Found):** 프로젝트가 존재하지 않거나, **다른 사용자의 프로젝트에 접근**하려 할 때.
      ```json
      {
        "statusCode": 404,
        "message": "Project not found.",
        "error": "Not Found"
      }
      ```

#### 2.4. 채용 프로젝트 수정 (Update)

* **Endpoint:** `PATCH /postings/:id`
* **Description:** 특정 프로젝트의 정보를 수정합니다. 이 API는 `INP-001`, `INP-003` 등 모든 정보 입력을 처리하는 **핵심 저장 API**로 사용됩니다.
* **Request:**
    * **Path Variable:** `id`
    * **Body:** (수정하려는 필드만 포함)
      ```json
      {
        "title": "주니어 백엔드 개발자 채용 (수정)",
        "jobTitle": "Junior Backend Developer"
      }
      ```
* **Response:**
    * **Success (200 OK):** 수정이 완료된 리소스 반환.
      ```json
      {
        "id": "clx123abcde",
        "title": "주니어 백엔드 개발자 채용 (수정)",
        "jobTitle": "Junior Backend Developer",
        // ... (다른 필드들은 유지)
        "updatedAt": "2025-10-17T03:00:00.000Z"
      }
      ```
    * **Error (404 Not Found):** (상세 조회와 동일)

#### 2.5. 채용 프로젝트 삭제 (Delete)

* **Endpoint:** `DELETE /postings/:id`
* **Description:** 특정 프로젝트를 삭제합니다.
* **Request:**
    * **Path Variable:** `id`
* **Response:**
    * **Success (204 No Content):** Body 없이 상태 코드만 반환합니다.
    * **Error (404 Not Found):** (상세 조회와 동일)

### 3\. 핵심 비즈니스 로직 (Core Business Logic)

1.  **인증 확인 (Authentication):**
    * 모든 `posting.controller.ts`의 핸들러는 NestJS의 `AuthGuard('jwt')`를 통과해야 합니다.
    * `Request` 객체에서 `user` 정보(e.g., `userId`)를 추출합니다.
2.  **소유권 확인 (Authorization):**
    * `GET /:id`, `PATCH /:id`, `DELETE /:id` 요청 시, `posting.service.ts`는 DB 조회 시 `id`와 `userId`가 **동시에 일치**하는지 확인해야 합니다.
    * `Prisma` 쿼리 예시:
      ```typescript
      const project = await this.prisma.jobPosting.findUnique({
        where: { id: postingId, userId: userId },
      });
      if (!project) {
        throw new NotFoundException('Project not found.');
      }
      ```
    * 이를 통해 다른 사용자가 URL을 추측하여 타인의 프로젝트에 접근하는 것을 원천 차단합니다.
3.  **프로젝트 생성 (`POST /postings`):**
    * `title`과 `userId`를 받아 `JobPosting` 테이블에 새 레코드를 생성합니다.
    * 초기 `status`는 `DRAFT`로 설정합니다.
4.  **프로젝트 수정 (`PATCH /postings/:id`):**
    * 소유권 확인 로직을 통과한 후, 요청 body에 들어온 데이터만 `update` 쿼리를 통해 반영합니다.
    * `updatedAt` 타임스탬프가 자동으로 갱신됩니다.

### 4\. 데이터 모델 (Data Model)

`USR-001`에서 정의한 `User` 모델과 `1:N` 관계를 설정합니다.

* **ORM:** Prisma
* **Database:** PostgreSQL
* **Model (`schema.prisma`):**

<!-- end list -->

```prisma
// ... (User 모델은 USR-001과 동일) ...

model User {
  id                 String    @id @default(cuid())
  // ... (기존 필드) ...

  // 한 명의 유저는 여러 개의 채용 프로젝트를 가질 수 있음
  jobPostings JobPosting[]
}

model JobPosting {
  id        String   @id @default(cuid())
  title     String   // PRJ-001: 프로젝트 제목
  status    String   @default("DRAFT") // 예: DRAFT, PUBLISHED, ARCHIVED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  //--- User와의 관계 설정 (Foreign Key) ---
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade) // 사용자가 삭제되면 프로젝트도 함께 삭제
  userId String @map("user_id")

  //--- INP-001: 핵심 채용 정보 ---
  companyName   String? @map("company_name")
  jobType       String? @map("job_title")        // 직종
  position       String? @map("job_title")        // 직무
  careerLevel   String? @map("career_level")  // 경력 요건 (신입, 경력, 무관)
  employmentType String? @map("employment_type") // 고용 형태 (정규직, 계약직)
  salaryRange   String? @map("salary_range")   // 급여 수준
  workLocation  String? @map("work_location")  // 근무지

  //--- INP-003: 기업 정보 ---
  companyIntro    String? @map("company_intro")
  companyCulture  String? @map("company_culture")
  benefits        String? @map("benefits")         // 복리후생 (텍스트)
  logoImageUrl    String? @map("logo_image_url")

  //--- INP-004: 스타일 설정 ---
  colorTone       String? @map("color_tone")       // "blue", "green"
  styleConcept    String? @map("style_concept")    // "professional", "friendly"
  
  //--- INP-005: 혜택 (별도 테이블 관리 가능성 있음) ---
  selectedBenefitsJson String? @map("selected_benefits_json") // 선택된 혜택 ID 목록 (JSON 문자열)
  
  //--- GEN-001/002: 생성된 결과물 ---
  generatedPosterUrl String? @map("generated_poster_url")
  generatedBannerUrl String? @map("generated_banner_url")
  generatedHtml      String? @map("generated_html")
  
  @@index([userId]) // 사용자가 자기 프로젝트 목록을 빠르게 조회하도록 인덱스 설정
}
```

### 5\. 예외 처리 (Exception Handling)

| HTTP Status | 발생 상황 (Scenario) | 처리 주체 | 응답 메시지 |
| :--- | :--- | :--- | :--- |
| **401 Unauthorized** | JWT 토큰이 없거나 유효하지 않을 때. | `AuthGuard` | `"Unauthorized"` |
| **404 Not Found** | 존재하지 않는 `postingId`로 요청하거나, **자신이 소유하지 않은** 프로젝트에 접근하려 할 때. | `posting.service.ts` | `"Project not found."` |
| **400 Bad Request** | `POST /postings` 요청 시 `title` 필드가 누락되었을 때. | `ValidationPipe` | `"title should not be empty"` |
| **500 Internal Server Error** | 데이터베이스 연결 실패 등 예측하지 못한 서버 오류. | `NestJS` 기본 | `"Internal server error"` |